<!-- MarkdownTOC -->

- 1.二叉树的最近公共祖先

<!-- /MarkdownTOC -->

#### 1.二叉树的最近公共祖先
https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-tree/ <br>
找最近的公共祖先，一定满足下面的条件：
> * 某一个节点左子树有p，右子树有q；或者左子树有q，右子树有p；
> * 某一个节点就是p，然后左子树或者右子树中有q；
> * 某一个节点就是q，然后左子树或者右子树中有p；

(leftHasNode || rightHasNode) || (root.val == p.val || root.val == q.val) <br>


```
class Solution_041 {
    private TreeNode res = null;

    private boolean hasNode(TreeNode root, TreeNode p, TreeNode q) {
        if (root == null) {
            return false;
        }
        boolean leftHasNode = hasNode(root.left, p, q);
        boolean rightHasNode = hasNode(root.right, p, q);
        if ((leftHasNode && rightHasNode) || ((leftHasNode || rightHasNode) && (root.val == p.val || root.val == q.val))) {
            res = root;
        }
        return (leftHasNode || rightHasNode) || (root.val == p.val || root.val == q.val);
    }

    public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) {
        hasNode(root, p, q);
        return res;
    }
}
```

我们还可以使用p和q节点向上寻找到最近的相同节点，这个节点就是最近的祖先节点。<br>
但是题目中没有给出parent的指针，那我们可以使用Stack来实现<br>
> * 首先深度遍历树，将树的内容放在Stack上
> * 找到p节点，记录一下p到root之间所有的访问节点记录
> * 找到q节点，向上到root节点记录访问路径，第一个在p访问记录中出现的就是最近的祖先节点
```
class Solution {
    Map<Integer, TreeNode> parent = new HashMap<Integer, TreeNode>();
    Set<Integer> visited = new HashSet<Integer>();

    public void dfs(TreeNode root) {
        if (root.left != null) {
            parent.put(root.left.val, root);
            dfs(root.left);
        }
        if (root.right != null) {
            parent.put(root.right.val, root);
            dfs(root.right);
        }
    }

    public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) {
        dfs(root);
        while (p != null) {
            visited.add(p.val);
            p = parent.get(p.val);
        }
        while (q != null) {
            if (visited.contains(q.val)) {
                return q;
            }
            q = parent.get(q.val);
        }
        return null;
    }
}
```